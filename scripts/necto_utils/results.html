<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NECTOStudio Overall Results - CURRENT_DATE</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#12172a; --muted:#9aa4b8; --text:#eaf0ff; --accent:#67b8ff; --accent-2:#7ef0c1;
      --success:#11371c; --success-border:#1e6e31; --success-chip:#2bbf62;
      --fail:#3a1214; --fail-border:#7a262b; --fail-chip:#ff6b6b;
      --ring: #2e3652; --card:#0f1427; --border:#222a44;
      --warning:#3b2a00; --warning-border:#b08900; --warning-text:#ffe9a6;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", sans-serif; background:radial-gradient(1000px 800px at 10% -5%, rgba(103,184,255,.08), transparent 45%), radial-gradient(800px 600px at 110% 0%, rgba(126,240,193,.07), transparent 50%), var(--bg); color:var(--text)}
    .wrap{max-width:1200px; margin:32px auto; padding:0 20px}
    h1{margin:0 0 12px; font-size:clamp(1.4rem,1.4rem + 1.2vw,2.1rem)}
    .sub{color:var(--muted); margin:0 0 18px}

    /* Top tabs */
    .tabs{display:flex; flex-wrap:wrap; gap:10px; margin:16px 0 12px}
    .tab-btn{appearance:none; border:1px solid var(--border); background:linear-gradient(180deg, #141a31, #0f152b); color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer; transition:.2s; box-shadow:inset 0 1px 0 rgba(255,255,255,.05)}
    .tab-btn:hover{transform:translateY(-1px); box-shadow:0 6px 18px rgba(0,0,0,.35)}
    .tab-btn.active{outline:2px solid var(--ring); background:linear-gradient(180deg, #1a2140, #121a37); color:#fff}

    .panel{background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 10px 28px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.03)}

    /* Sub-tabs */
    .subtabs{display:flex; gap:8px; margin:4px 0 12px}
    .sub-btn{appearance:none; border:1px solid var(--border); background:#0f152b; color:var(--muted); padding:8px 12px; border-radius:999px; cursor:pointer; transition:.2s}
    .sub-btn.active{color:#fff; background:#1a2140; outline:2px solid var(--ring)}

    /* NEW: Explanation block */
    .explain{margin:8px 0 12px; border:1px solid var(--border); border-radius:12px; background:#0f152b}
    .explain > summary{cursor:pointer; list-style:none; padding:10px 12px; font-weight:600; letter-spacing:.2px; display:flex; align-items:center; gap:10px}
    .explain > summary::before{content:"▸"; transition:transform .2s}
    .explain[open] > summary::before{transform:rotate(90deg)}
    .explain-content{padding:10px 12px 12px; color:var(--muted)}
    .explain-content ul{margin:.4rem 0 .6rem 1.2rem}
    .explain-content a{color:var(--accent)}
    .explain .note{margin-top:10px; border:1px dashed var(--warning-border); background:linear-gradient(180deg, #1a1600, #141106); color:var(--warning-text); padding:10px 12px; border-radius:10px}
    .explain .note strong{color:#fff}

    /* Info bar */
    .bar{display:flex; justify-content:space-between; align-items:center; gap:12px; margin:8px 0 14px; color:var(--muted); font-size:.95rem}
    .pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#0e1428}
    .dot{width:8px; height:8px; border-radius:50%}

    /* Grid (4 per row) */
    .grid{display:grid; grid-template-columns:repeat(4, minmax(0, 1fr)); gap:12px}
    @media (max-width:1000px){ .grid{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:760px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:520px){ .grid{grid-template-columns:1fr} }

    .card{border-radius:14px; padding:14px; border:1px solid var(--border); background:var(--card); display:flex; flex-direction:column; gap:8px; min-height:92px}
    .card.success{background:linear-gradient(180deg, var(--success), #0c1f12); border-color:var(--success-border)}
    .card.failed{background:linear-gradient(180deg, var(--fail), #1f0b0c); border-color:var(--fail-border)}
    .name {font-weight:600; letter-spacing:.2px; word-break: break-word; white-space: normal}
    .chip{align-self:flex-start; padding:4px 8px; border-radius:999px; font-size:.8rem; border:1px solid rgba(255,255,255,.15)}
    .success .chip{background:rgba(43,191,98,.15); color:#bff5d5; border-color:rgba(46,158,94,.6)}
    .failed .chip{background:rgba(255,107,107,.12); color:#ffd2d2; border-color:rgba(255,107,107,.55)}

    .empty{border:1px dashed var(--border); border-radius:14px; padding:18px; text-align:center; color:var(--muted)}
    .footer{margin:18px 0 0; color:var(--muted); font-size:.9rem}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background:#0f162c; padding:2px 6px; border-radius:6px; border:1px solid var(--border)}

    .tab-btn.tab-green {
        background: linear-gradient(180deg, #0f2b1b, #12351f);
        border-color: #1e6e31;
        color: #bff5d5;
    }
    .tab-btn.tab-red {
        background: linear-gradient(180deg, #3a1214, #1f0b0c);
        border-color: #7a262b;
        color: #ffd2d2;
    }
    .tab-btn.tab-yellow {
        background: linear-gradient(180deg, #2b2b0f, #353512);
        border-color: #7a7a26;
        color: #fff6bf;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>NECTOStudio Overall Results</h1>
    <p class="sub">Eight-step report with Succeeded/Failed sub-tabs.</p>

    <!-- Top step tabs -->
    <div id="stepTabs" class="tabs" role="tablist" aria-label="Steps"></div>

    <div class="panel" id="panel">
      <!-- Sub-tabs -->
      <div class="subtabs" role="tablist" aria-label="Result tabs">
        <button class="sub-btn active" data-kind="succeeded" id="subSucceeded" aria-selected="true">Succeeded</button>
        <button class="sub-btn" data-kind="failed" id="subFailed" aria-selected="false">Failed</button>
      </div>

      <!-- NEW: Foldable explanation (per-step) -->
      <details class="explain" id="explain">
        <summary id="explainSummary">Step overview</summary>
        <div class="explain-content" id="explainContent"></div>
      </details>

      <div class="bar">
        <div class="pill"><span class="dot" id="dot" style="background:var(--success)"></span><span id="barLabel">Showing Succeeded</span></div>
        <div class="pill">Step: <strong id="barStep" style="margin-left:6px">1</strong></div>
        <div class="pill">Count: <strong id="barCount" style="margin-left:6px">0</strong></div>
      </div>

      <!-- Content grid -->
      <div id="grid" class="grid" aria-live="polite"></div>

      <div id="empty" class="empty" style="display:none">No items to display for this filter.</div>

      <div class="footer">Tip: Use <span class="kbd">[1–8]</span> to switch steps, <span class="kbd">S</span>/<span class="kbd">F</span> for sub-tabs, and <span class="kbd">E</span> to toggle the explanation.</div>
    </div>
  </div>

  <script>
    /* =====================
       Data model (lists wired elsewhere)
       ===================== */
    const stepData = {
      1: { succeeded: [STEP1_PASSED], failed: [STEP1_FAILED] },
      2: { succeeded: [STEP2_PASSED], failed: [STEP2_FAILED] },
      3: { succeeded: [STEP3_PASSED], failed: [STEP3_FAILED] },
      4: { succeeded: [STEP4_PASSED], failed: [STEP4_FAILED] },
      5: { succeeded: [STEP5_PASSED], failed: [STEP5_FAILED] },
      6: { succeeded: [STEP6_PASSED], failed: [STEP6_FAILED] },
      7: { succeeded: [STEP7_PASSED], failed: [STEP7_FAILED] },
      8: { succeeded: [STEP8_PASSED], failed: [STEP8_FAILED] }
    };

    /* =====================
       Explanations per step (HTML strings)
       ===================== */
    const stepExplanations = {
      1: {
        title: "Step 1 – Check installation of mandatory NECTO packages",
        html: `
          <ul>
            <li>Download NECTO installer.</li>
            <li>Verify installer archive / disk image is present.</li>
            <li>Extract runner for the installer.</li>
            <li>Run the NECTO installer for mandatory packages.</li>
            <li>Confirm all mandatory packages were installed.</li>
          </ul>
          <div class="note"><strong>Note:</strong> If any package fails, immediately do the following:
            <ul>
              <li>Check the presence in latest <a href="https://github.com/MikroElektronika/core_packages/releases" target="_blank" rel="noreferrer">core_packages</a> release.</li>
              <li>Verify the download link in <a href="https://kibana.mikroe.com/s/sw-space/app/dev_tools#/console/shell" target="_blank" rel="noreferrer">Elasticsearch (Kibana)</a>.</li>
              <li>Fix any issues found.</li>
            </ul>
          </div>
        `
      },
      2: {
        title: "Step 2 – Install all CORE, BSP, CODEGRIP, and MCHP NECTO packages",
        html: `
          <ul>
            <li>Get latest SDK version from database.</li>
            <li>Fetch all packages & dependencies:
              <ul>
                <li>Core package and all mapped MCUs.</li>
                <li>Card package and SDK configuration.</li>
                <li>Board package and SDK configuration.</li>
                <li>CODEGRIP package and all mapped MCUs.</li>
                <li>MCHP prog package and all mapped MCUs (XC compilers only).</li>
              </ul>
            </li>
            <li>Fetch all indexed packages from Elasticsearch.</li>
            <li>Run NECTO installer for all found packages:
              <ul>
                <li>Fetch install location info for each package via Kibana.</li>
                <li>Verify installed package exists at that location.</li>
              </ul>
            </li>
          </ul>
          <div class="note"><strong>Note:</strong> If any package fails:
            <ul>
              <li>Check presence in latest <a href="https://github.com/MikroElektronika/core_packages/releases" target="_blank" rel="noreferrer">core_packages</a> or <a href="https://github.com/MikroElektronika/mikrosdk_v2/releases" target="_blank" rel="noreferrer">mikrosdk_v2</a> release.</li>
              <li>Verify download link in <a href="https://kibana.mikroe.com/s/sw-space/app/dev_tools#/console/shell" target="_blank" rel="noreferrer">Elasticsearch</a>.</li>
              <li>Fix any issues found.</li>
            </ul>
          </div>
        `
      },
      3: {
        title: "Step 3 – Create dependencies file for MCUs, Boards, Cards, and packages",
        html: `
          <ul>
            <li>Get latest SDK version from database.</li>
            <li>Collect all packages & dependencies (Core, Card, Board, CODEGRIP, MCHP as in Step 2).</li>
            <li>Create the dependency file and upload it to the latest
              <a href="https://github.com/MikroElektronika/core_packages/releases" target="_blank" rel="noreferrer">core_packages</a> release to track DB changes.</li>
          </ul>
        `
      },
      4: {
        title: "Step 4 – Validate CORE-to-MCU dependencies",
        html: `
          <ul>
            <li>Read dependencies from the file generated in Step 3.</li>
            <li>Fetch indexed packages from Elasticsearch.</li>
            <li>For each Core package, ensure all mapped MCUs are covered by its regex:
              <ul>
                <li>Get install location from index info.</li>
                <li>Locate package and delays .cmake files in that path.</li>
                <li>Extract regexes from those CMake files.</li>
                <li>Verify each MCU's SDK configuration name matches the regex(es).</li>
              </ul>
            </li>
          </ul>
          <div class="note"><strong>Note:</strong> If any package fails:
            <ul>
              <li>Confirm presence in latest <a href="https://github.com/MikroElektronika/core_packages/releases" target="_blank" rel="noreferrer">core_packages</a> release.</li>
              <li>Check download link & install location in <a href="https://kibana.mikroe.com/s/sw-space/app/dev_tools#/console/shell" target="_blank" rel="noreferrer">Elasticsearch</a>.</li>
              <li>Manually verify that regex in both package delays .cmake matches the MCU SDK configuration name.</li>
              <li>Fix any issues found.</li>
            </ul>
          </div>
        `
      },
      5: {
        title: "Step 5 – Validate CODEGRIP-to-MCU dependencies",
        html: `
          <ul>
            <li>Read dependencies from the file generated in Step 3.</li>
            <li>Fetch indexed packages from Elasticsearch.</li>
            <li>For each CODEGRIP package, ensure all mapped MCUs are present in its files:
              <ul>
                <li>Get install location from index info.</li>
                <li>Verify .mcu files exist for all MCU names.</li>
              </ul>
            </li>
          </ul>
          <div class="note"><strong>Note:</strong> If any package fails:
            <ul>
              <li>Check download link & install location in <a href="https://kibana.mikroe.com/s/sw-space/app/dev_tools#/console/shell" target="_blank" rel="noreferrer">Elasticsearch</a>.</li>
              <li>Manually confirm a matching .mcu file exists in the CODEGRIP package.</li>
              <li>Inform the CODEGRIP Team to fix the issue.</li>
            </ul>
          </div>
        `
      },
      6: {
        title: "Step 6 – Validate MCHP-to-MCU dependencies",
        html: `
          <ul>
            <li>Read dependencies from the file generated in Step 3.</li>
            <li>Fetch indexed packages from Elasticsearch.</li>
            <li>For each Microchip prog package, ensure all mapped MCUs are present in its files:
              <ul>
                <li>Get install location from index info.</li>
                <li>Verify .PIC files exist for all MCU names.</li>
              </ul>
            </li>
          </ul>
          <div class="note"><strong>Note:</strong> If any package fails:
            <ul>
              <li>Check download link & install location in <a href="https://kibana.mikroe.com/s/sw-space/app/dev_tools#/console/shell" target="_blank" rel="noreferrer">Elasticsearch</a>.</li>
              <li>Manually confirm a matching .PIC file exists in the Microchip prog package.</li>
              <li>Inform the IDE Team to fix the issue.</li>
            </ul>
          </div>
        `
      },
      7: {
        title: "Step 7 – Validate Board-to-BSP dependencies",
        html: `
          <ul>
            <li>Read dependencies from the file generated in Step 3.</li>
            <li>Fetch indexed packages from Elasticsearch.</li>
            <li>For each Board package, ensure all mapped Boards are covered by its regex:
              <ul>
                <li>Get install location from index info.</li>
                <li>Locate the package CMake in that path.</li>
                <li>Verify the Board SDK configuration name matches the regex.</li>
              </ul>
            </li>
          </ul>
          <div class="note"><strong>Note:</strong> If any package fails:
            <ul>
              <li>Check presence in latest <a href="https://github.com/MikroElektronika/mikrosdk_v2/releases" target="_blank" rel="noreferrer">mikrosdk_v2</a> (or relevant) release.</li>
              <li>Verify download link & install location in <a href="https://kibana.mikroe.com/s/sw-space/app/dev_tools#/console/shell" target="_blank" rel="noreferrer">Elasticsearch</a>.</li>
              <li>Manually verify the Board CMake regex matches the Board SDK configuration name.</li>
              <li>Fix any issues found.</li>
            </ul>
          </div>
        `
      },
      8: {
        title: "Step 8 – Validate Card-to-BSP dependencies",
        html: `
          <ul>
            <li>Read dependencies from the file generated in Step 3.</li>
            <li>Fetch indexed packages from Elasticsearch.</li>
            <li>For each Card package, ensure all mapped Cards are covered:
              <ul>
                <li>Get install location from index info.</li>
                <li>Verify the installation folder name matches the Card SDK configuration name.</li>
              </ul>
            </li>
          </ul>
          <div class="note"><strong>Note:</strong> If any package fails:
            <ul>
              <li>Check presence in latest <a href="https://github.com/MikroElektronika/mikrosdk_v2/releases" target="_blank" rel="noreferrer">mikrosdk_v2</a> release.</li>
              <li>Verify download link & install location in <a href="https://kibana.mikroe.com/s/sw-space/app/dev_tools#/console/shell" target="_blank" rel="noreferrer">Elasticsearch</a>.</li>
              <li>Manually confirm installation folder name matches the Card SDK configuration name.</li>
              <li>Fix any issues found.</li>
            </ul>
          </div>
        `
      }
    };

    /* =====================
       UI wiring
       ===================== */
    const stepTabs = document.getElementById('stepTabs');
    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const barStep = document.getElementById('barStep');
    const barCount = document.getElementById('barCount');
    const barLabel = document.getElementById('barLabel');
    const dot = document.getElementById('dot');
    const explain = document.getElementById('explain');
    const explainSummary = document.getElementById('explainSummary');
    const explainContent = document.getElementById('explainContent');

    let currentStep = 1;
    let currentKind = 'succeeded';

    // Build step buttons
    for (let i=1; i<=8; i++){
      const btn = document.createElement('button');
      btn.className = 'tab-btn' + (i===1 ? ' active' : '');
      if (i==1)
        btn.textContent = `NECTO install`;
      else if (i==2)
        btn.textContent = `NECTO packages install`;
      else if (i==3)
        btn.textContent = `Dependency file creation`;
      else if (i==4)
        btn.textContent = `MCU-to-CORE dependencies`;
      else if (i==5)
        btn.textContent = `MCU-to-CODEGRIP dependencies`;
      else if (i==6)
        btn.textContent = `MCU-to-MCHP dependencies`;
      else if (i==7)
        btn.textContent = `BOARD-to-BSP dependencies`;
      else if (i==8)
        btn.textContent = `CARD-to-BSP dependencies`;
      btn.setAttribute('data-step', i);
      btn.setAttribute('role', 'tab');
      btn.addEventListener('click', () => setStep(i));
      stepTabs.appendChild(btn);
    }

    // Sub-tab buttons
    document.getElementById('subSucceeded').addEventListener('click', () => setKind('succeeded'));
    document.getElementById('subFailed').addEventListener('click', () => setKind('failed'));

    function setStep(step){
      currentStep = step;
      for (const b of stepTabs.querySelectorAll('.tab-btn')){
        b.classList.toggle('active', Number(b.dataset.step)===step);
      }

      const data = stepData[step] || {succeeded:[], failed:[]};
      if (data.failed && data.failed.length > 0) {
        setKind('failed');
      } else {
        setKind('succeeded');
      }
      render();
    }

    function setKind(kind){
      currentKind = kind;
      document.getElementById('subSucceeded').classList.toggle('active', kind==='succeeded');
      document.getElementById('subFailed').classList.toggle('active', kind==='failed');
      render();
    }

    function renderExplanation(){
      const exp = stepExplanations[currentStep];
      if (!exp){
        explain.style.display = 'none';
        return;
      }
      explain.style.display = '';
      explainSummary.textContent = exp.title;
      explainContent.innerHTML = exp.html;
      // Auto-open when viewing "Failed" to surface the checklist
      if (currentKind === 'failed') {
        explain.setAttribute('open', '');
      } else {
        explain.removeAttribute('open');
      }
    }

    function render(){
      const data = stepData[currentStep] || {succeeded:[], failed:[]};
      const list = data[currentKind] || [];
      grid.innerHTML = '';

      barStep.textContent = String(currentStep);
      barCount.textContent = String(list.length);
      barLabel.textContent = `Showing ${currentKind.charAt(0).toUpperCase()+currentKind.slice(1)}`;
      dot.style.background = currentKind==='succeeded' ? 'var(--success-chip)' : 'var(--fail-chip)';

      // Update tab coloring for all steps
      for (let i=1; i<=8; i++){
        const btn = stepTabs.querySelector(`.tab-btn[data-step="${i}"]`);
        btn.classList.remove('tab-green','tab-red','tab-yellow');
        const step = stepData[i] || {succeeded:[], failed:[]};
        if ((step.failed || []).length > 0) {
          btn.classList.add('tab-red');
        } else if ((step.succeeded || []).length > 0) {
          btn.classList.add('tab-green');
        } else {
          btn.classList.add('tab-yellow');
        }
      }

      // Explanation
      renderExplanation();

      if (!list.length){
        grid.style.display = 'none';
        empty.style.display = 'block';
        return;
      }
      grid.style.display = 'grid';
      empty.style.display = 'none';

      list.forEach((name) => {
        const card = document.createElement('div');
        card.className = `card ${currentKind==='succeeded' ? 'success' : 'failed'}`;
        card.innerHTML = `
          <div class="name">${escapeHtml(name)}</div>
          <div class="chip">${currentKind==='succeeded' ? 'Succeeded' : 'Failed'}</div>
        `;
        grid.appendChild(card);
      });
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#039;');
    }

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.key>='1' && e.key<='8'){ setStep(Number(e.key)); }
      if(e.key==='s' || e.key==='S'){ setKind('succeeded'); }
      if(e.key==='f' || e.key==='F'){ setKind('failed'); }
      if(e.key==='e' || e.key==='E'){ // toggle explanation
        if (explain.hasAttribute('open')) explain.removeAttribute('open');
        else explain.setAttribute('open','');
      }
    });

    // Initial render
    render();
  </script>
</body>
</html>
